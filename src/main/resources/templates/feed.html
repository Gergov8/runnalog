<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <meta charset="UTF-8"/>
    <title>Feed - RunnaLog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

    <!-- TailwindCSS CDN (jit) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        gold: {
                            DEFAULT: '#D4AF37',
                            soft: '#E6C967',
                            light: '#F5E7C5'
                        }
                    },
                    fontFamily: {
                        poppins: ['Poppins', 'ui-sans-serif', 'system-ui', 'sans-serif'],
                        mont: ['Montserrat', 'ui-sans-serif', 'system-ui', 'sans-serif'],
                        roboCond: ['Roboto Condensed', 'ui-sans-serif', 'system-ui', 'sans-serif']
                    },
                    boxShadow: {
                        glow: '0 0 0 2px rgba(212,175,55,0.35), 0 8px 30px rgba(0,0,0,0.35)',
                        gold: '0 0 20px rgba(212,175,55,0.4)'
                    },
                    backdropBlur: {
                        xs: '2px'
                    }
                }
            }
        }
    </script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&family=Open+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/feed.css">

</head>
<body class="min-h-screen overflow-x-hidden bg-black text-white font-open-sans">
<!-- Background elements -->
<div class="bg-layer">
    <img src="/images/background.png" alt="Background" />
</div>

<!-- Header -->
<header class="header">
    <div class="logo"><a href="/feed">RUNNALOG</a></div>
    <div class="header-actions">
        <div class="strides-balance-header">
            <span class="strides-amount-header" th:text="${stats != null} ? ${stats.strides} : 0">12,500</span>
            <span class="strides-label-header">Strides</span>
        </div>

        <a class="btn btn-primary" th:href="@{'/runs/add'}">ADD RUN</a>
        <a class="btn btn-primary" href="/subscriptions">UPGRADE</a>

        <!-- ðŸ‘‡ Only visible to admins -->
        <div sec:authorize="hasRole('ADMIN')">
            <a class="btn btn-primary" href="/users">MANAGE USERS</a>
        </div>

        <!-- Show Personal Coach for Elite users -->
        <div th:if="${hasEliteSubscription || user.role.displayName.equals('Admin')}">
            <a class="btn btn-primary" th:href="@{/training/plans}">PERSONAL COACH</a>
        </div>

        <a class="btn btn-primary" href="/logout">LOGOUT</a>
    </div>

</header>

<!-- Main content -->
<main class="feed-container">
    <div class="feed-layout grid grid-cols-12 gap-6">

        <!-- Profile section -->
        <aside class="profile-card col-span-3">
            <div class="avatar-lg">
                <a th:href="@{'/users/profile'}">
                    <img th:src="${#strings.isEmpty(user.profilePicture) ? 'https://www.svgrepo.com/show/384670/account-avatar-profile-user.svg' : user.profilePicture}" alt="Profile picture">
                </a>
            </div>

            <a th:href="@{'/users/profile'}">
                <div class="profile-name" th:text="${user.username}">martin_gergov</div>
            </a>
            <div class="profile-status">
                <span th:if="${user.isActive()}" class="active-profile">ACTIVE</span>
                <span th:if="${!user.isActive()}" class="inactive-profile">INACTIVE</span>
            </div>
            <div class="profile-stats">
                <div class="profile-row"><span class="muted">Total runs</span><strong th:text="${stats.totalRuns}">10</strong></div>
                <div class="profile-row"><span class="muted">Total distance</span><strong th:text="${stats.totalDistance}">100 km</strong></div>
                <div class="profile-row"><span class="muted">Total duration</span><strong th:text="${stats.totalDuration}">09:00:00</strong></div>
                <div class="profile-row"><span class="muted">PB 1km</span><strong th:text="${stats.pb1km}">10</strong></div>
                <div class="profile-row"><span class="muted">PB 5km</span><strong th:text="${stats.pb5km}">100 km</strong></div>
                <div class="profile-row"><span class="muted">PB 10km</span><strong th:text="${stats.pb10km}">09:00:00</strong></div>
            </div>
        </aside>

        <!-- Runs section -->
        <section class="runs-section col-span-6">
            <article th:each="run : ${feedRuns}" class="feed-card">
                <div class="feed-header">
                    <a th:href="${'/runs/' + run.userId}">
                        <div class="avatar-sm">
                            <img th:src="${#strings.isEmpty(run.profilePic)
                             ? 'https://www.svgrepo.com/show/384670/account-avatar-profile-user.svg'
                             : run.profilePic}"
                                 alt="Profile picture">
                        </div>
                    </a>

                    <div>
                        <a th:href="${'/runs/' + run.id + '/details'}">
                            <div class="feed-user" th:text="${run.title}">title</div>
                        </a>
                        <a th:href="${'/runs/' + run.userId}">
                            <strong>
                                <div class="feed-sub" th:text="${run.username}">username</div>
                            </strong>
                        </a>
                    </div>
                </div>

                <div class="metrics">
                    <div class="metric">
                        <div class="metric-k">Distance</div>
                        <div class="metric-v" th:text="${run.distance} + ' km'">5 km</div>
                    </div>
                    <div class="metric">
                        <div class="metric-k">Duration</div>
                        <div class="metric-v" th:text="${run.duration}">00:25:00</div>
                    </div>
                    <div class="metric">
                        <div class="metric-k">Pace</div>
                        <div class="metric-v" th:text="${run.pace} + ' /km'">05:00 /km</div>
                    </div>
                </div>

                <div class="feed-actions">
                    <form th:action="${'/runs/' + run.id + '/' + (run.likedByCurrentUser ? 'unlike' : 'like')}" method="post">
                        <input type="hidden" name="_csrf" th:value="${_csrf.token}">
                        <button class="like-btn" th:classappend="${run.likedByCurrentUser} ? ' liked' : ''">
                            <span class="heart-icon" th:text="${run.likedByCurrentUser} ? 'â¤ï¸' : 'ðŸ¤'"></span>
                            <span th:text="${run.likesCount}">0</span>
                        </button>
                    </form>
                    <a th:href="${'/runs/' + run.id + '/details'}">
                        <button class="comment-btn">ðŸ’¬ Comment</button>
                    </a>
                </div>
            </article>

        </section>

        <aside class="leaderboard-card col-span-3">
            <h2 class="leaderboard-title">Daily Leaderboard</h2>

            <div class="leaderboard-list">
                <div class="leaderboard-header">
                    <span>#</span>
                    <span>User</span>
                    <span>Today</span>
                </div>

                <div class="leaderboard-row" th:each="entry, iter : ${leaderboard}">
                    <span class="position" th:text="${iter.index + 1}">1</span>

                    <div class="lb-user">
                        <span th:text="${entry.username}">martin</span>
                    </div>

                    <span class="today-km"
                          th:text="${entry.kilometers() + ' km'}">12 km</span>
                </div>

                <div th:if="${#lists.isEmpty(leaderboard)}" class="leaderboard-empty">
                    No activity today.
                </div>
            </div>
        </aside>


    </div>
</main>

</body>
</html>
